# Модельный веб сервер

Я сделал веб-сервер, который умеет отдавать статику и выполнять CGI-программы, написанные на модельном JS. Запросы обрабатываются асинхронно.
Рукописный интерпретатор для модельного JS лежит в папке cgi-bin и вызывается посредством системного вызова execve(). \
API был навеен популярным фреймворком [expressjs](https://github.com/expressjs/express).
 
### Установка и запуск
Для компиляции и запуска можно использовать makefile.

```sh
$ make
$ make run
```

### Пример использования
Когда мы формируем наш сервер, можем в качестве параметра передать номер порта и имя файла для логов. По умолчанию сервер рабоает на 8080 порте и пишет логи в "log.txt".

```cpp
#include "http_server.h"

int main(){
    Server app(3000, "logFile.txt");
    app.Get("/", "test1.html");
    app.Get("/hello", "test2.html"); //файла не существует, получаем ответ 500
    app.use("cgi-bin"); //Директория с CGI-программами
    app.run();
    return 0;
}
```
### CGI
Я добавил поддержку CGI. Для этого нужно при формировании нашего сервера указать следующую инструкцию: 
```cpp
app.use("cgi-bin"); //или другое желаемое имя папки вместо cgi-bin
```
При запросе к /test.mjs будет выполнена проверка на наличие этого маршрута в списке статических. Если такового маршрута нет, то в указанной папке с CGI-программами будет выполнен поиск файла с именем "test.mjs", затем сервер форкнется и внутри запустит интерпретатор. Если файла с именем "test.mjs" нет, то сервер вернет 404. \
Программы должны быть написаны на модельном JS.

### Модельный JavaScript
Язык поддерживает три типа данных: 
* Integer (var number = 1;)
* String (var str = "string variable";)
* Boolean (var boolVar = true;)

Поведение типов очень похоже на поведение типов в традиционном JS. При вычислении выражения, правый операнд приводится к типу первого, а затем уже выполняется операция. Из особенностей стоит отметить, что строка приводится к true тогда и только тогда, когда она равна "true", в противном же случае, она приведется к false. 

Доступны циклы **for()** и **while()** и конструкция **if-else**\
Вывод осущеcтвляется при помощи функции **write()** \
Доступна возможность получения переменной окружения при помощи вызова **getenv()**

[Подробнее в соответсвующем репозитории](https://github.com/de-tolkac/Denis-Tolkachev-214-prak/tree/master/zadanie4)

### Обработка ошибок
![](https://i.ibb.co/kSKtC7R/2020-04-10-0-15-50.png)

> Попытка совершить запрос к необъявленному маршруту. Ответ: 404

![](https://i.ibb.co/MpgjvPH/2020-04-10-0-15-58.png)
> Попытка выполнить POST запрос. Ответ: 501

![](https://i.ibb.co/5sk5bNX/2020-04-11-20-38-52.png)
>Пытаемся открыть /hello, но файл test2.html не существует на сервере. Ответ: 500